(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
var facebook_app_id;

facebook_app_id = '1495109164043412';

require("./services");

require("./filters");

require("./directives");

require("./controllers");

angular.module('iwishua', ['ngTouch', 'ngRoute', 'ngFacebook', 'breeze.angular', 'iwishua.services', 'iwishua.filters', 'iwishua.directives', 'iwishua.controllers']).config(function($routeProvider, $facebookProvider) {
  $facebookProvider.setAppId("" + facebook_app_id);
  $facebookProvider.setPermissions("publish_stream");
  $facebookProvider.setCustomInit({
    xfbml: true,
    version: 'v2.0'
  });
  return $routeProvider.when('/', {
    templateUrl: 'partials/wish.html',
    controller: 'WishController'
  }).when('/list/:skip', {
    templateUrl: 'partials/wish.html',
    controller: 'WishController'
  }).when('/hidden', {
    templateUrl: 'partials/hidden.html',
    controller: 'HiddenController'
  }).when('/hidden/:skip', {
    templateUrl: 'partials/hidden.html',
    controller: 'HiddenController'
  }).when('/about', {
    templateUrl: 'partials/about.html',
    controller: 'AboutController'
  }).when('/privacy', {
    templateUrl: 'partials/privacy.html',
    controller: 'AboutController'
  }).when('/support', {
    templateUrl: 'partials/about.html',
    controller: 'AboutController'
  }).otherwise({
    redirectTo: '/'
  });
}).run(function() {
  (function(d) {
    var id, js, ref;
    id = "facebook-jssdk";
    ref = d.getElementsByTagName("script")[0];
    if (d.getElementById(id)) {
      return;
    }
    js = d.createElement("script");
    js.id = id;
    js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=" + facebook_app_id;
    return ref.parentNode.insertBefore(js, ref);
  })(document);
  if (document.addEventListener) {
    return document.addEventListener('touchmove', function(e) {
      return e.preventDefault();
    });
  }
});

},{"./controllers":2,"./directives":8,"./filters":9,"./services":10}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
angular.module('iwishua.controllers', []).controller('FBController', ['$scope', 'logger', '$facebook', require('./controllers/FBController')]).controller('AboutController', ['$scope', 'logger', require('./controllers/AboutController')]).controller('PrivacyController', ['$scope', 'logger', require('./controllers/PrivacyController')]).controller('ListController', ['$scope', 'logger', require('./controllers/ListController')]).controller('WishController', ['$scope', 'logger', 'entityManager', '$routeParams', '$location', require('./controllers/WishController')]);

},{"./controllers/AboutController":3,"./controllers/FBController":4,"./controllers/ListController":5,"./controllers/PrivacyController":6,"./controllers/WishController":7}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
module.exports = function($scope, logger) {};

},{}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
module.exports = function($scope, logger, $facebook) {
  return $facebook.api("/me").then(function(response) {
    return $scope.username = response.first_name;
  });
};

},{}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var ListController;

ListController = (function() {
  function ListController($scope, logger) {
    logger.info("List");
  }

  return ListController;

})();

module.exports = ListController;

},{}],6:[function(require,module,exports){
module.exports=require(3)
},{}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
module.exports = function($scope, logger, entityManager, $routeParams, $location) {
  var perPage, spinner;
  perPage = 5;
  if ($routeParams.skip == null) {
    $routeParams.skip = 0;
  }
  $scope.navLeft = function($event) {
    return $location.path("/list/" + (parseInt($routeParams.skip, 10) + perPage));
  };
  $scope.navRight = function($event) {
    return $location.path("/list/" + (Math.max(parseInt($routeParams.skip, 10) - perPage, 0)));
  };
  spinner = new Spinner({
    radius: 30,
    width: 8,
    length: 16
  });
  spinner.spin(document.getElementById('wish-spinner'));
  return entityManager.getProducts($routeParams.skip).then(function(data) {
    var masonry;
    $(".wish-splash").hide();
    spinner.stop();
    $scope.skip = parseInt($routeParams.skip, 10) + perPage;
    entityManager.parseProducts($scope, data);
    return (masonry = $(".js-masonry")).imagesLoaded(function() {
      return masonry.masonry();
    });
  });
};

},{}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
angular.module('iwishua.directives', []).directive('appVersion', function(version) {
  return {
    restrict: 'A',
    link: function($scope, $element, $attrs) {
      return $element.text(version);
    }
  };
}).directive('fixCollapse', function($document) {
  return {
    restrict: 'A',
    link: function($scope, $element, $attrs) {
      $element.collapse({
        toggle: false
      });
      return $document.on('click', function() {
        return $element.collapse('hide');
      });
    }
  };
});

},{}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
angular.module('iwishua.filters', []).filter('capitalise', function(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
});

},{}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
angular.module('iwishua.services', []).value('version', '0.1.0').service('logger', ['$log', require('./services/Logger')]).service('entityManager', ['breeze', 'logger', require('./services/Products')]);

},{"./services/Logger":11,"./services/Products":12}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
var Logger;

Logger = (function() {
  toastr.options.timeOut = 2000;

  toastr.options.positionClass = 'toast-bottom-right';

  function Logger($log) {
    this.$log = $log;
  }

  Logger.prototype.error = function(message, title) {
    toastr.error(message, title);
    return this.$log.error("Error: " + message);
  };

  Logger.prototype.info = function(message, title) {
    toastr.info(message, title);
    return this.$log.info("Info: " + message);
  };

  Logger.prototype.log = function(message) {
    return this.$log.log(message);
  };

  Logger.prototype.success = function(message, title) {
    toastr.info(message, title);
    return this.$log.info("Success: " + message);
  };

  Logger.prototype.warning = function(message, title) {
    toastr.info(message, title);
    return this.$log.warn("Warning: " + message);
  };

  return Logger;

})();

module.exports = Logger;

},{}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
'use strict';
var Products;

Products = (function() {
  function Products(breeze, logger) {
    var metadataHelper, metadataStore, modelNamespace, serviceName;
    this.breeze = breeze;
    this.logger = logger;
    serviceName = "https://iwishuadata.azure-mobile.net/";
    modelNamespace = "Iwishua.Models";
    this.modelName = "iwishuaproducts";
    metadataStore = new this.breeze.MetadataStore({
      namingConvention: this.breeze.NamingConvention.camelCase
    });
    metadataHelper = new this.breeze.config.MetadataHelper(modelNamespace);
    metadataHelper.addTypeToStore(metadataStore, {
      namespace: modelNamespace,
      shortName: this.modelName,
      defaultResourceName: this.modelName,
      dataProperties: {
        id: {
          maxLength: 36
        },
        productId: {
          maxLength: 36
        },
        productTitle: {
          maxLength: 4000
        },
        productDescription: {
          maxLength: 4000
        },
        productImageUrl: {
          maxLength: 4000
        },
        productBuyUrl: {
          maxLength: 4000
        },
        productKeywords: {
          maxLength: 4000
        },
        impressionUrl: {
          maxLength: 4000
        },
        isPublished: {
          dataType: this.breeze.DataType.Boolean
        }
      }
    });
    metadataHelper.addDataService(metadataStore, serviceName);
    this.entityManager = new this.breeze.EntityManager({
      metadataStore: metadataStore,
      serviceName: serviceName
    });
  }

  Products.prototype.getProducts = function(skip, take) {
    var query;
    if (skip == null) {
      skip = 0;
    }
    if (take == null) {
      take = 5;
    }
    query = this.breeze.EntityQuery.from("tables/" + this.modelName).skip(parseInt(skip, 10)).take(parseInt(take, 10)).where('isPublished', 'eq', true).inlineCount(true);
    return this.entityManager.executeQuery(query)["catch"]((function(_this) {
      return function(error) {
        _this.logger.error(error.message, "Query failed");
        throw error;
      };
    })(this));
  };

  Products.prototype.parseProducts = function($scope, data) {
    var attrs, name, title, word, words, _i, _j, _len, _len1, _ref, _ref1, _results;
    $scope.count = data.results[0].count;
    $scope.products = data.results[0].results;
    _ref = $scope.products;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      attrs = _ref[_i];
      title = attrs.productTitle;
      if (title.slice(0, 1) === '"') {
        title = title.slice(1, -1);
      }
      words = title.replace(/[-,.©®™]/g, ' ').replace(/([a-z])([A-Z])/g, "$1 $2").split(/\s+/);
      title = words.join(' ');
      attrs.productTitle = title;
      name = '';
      while (!(name.length > 20 || words.length === 0)) {
        name = words.pop() + ' ' + name.substr(0, 1).toUpperCase() + name.substr(1);
      }
      attrs.productName = name;
      attrs.className = 'ww2';
      _ref1 = name.split(/\s+/);
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        word = _ref1[_j];
        if (word.length > 7) {
          attrs.className = 'hh2';
        }
      }
      if (attrs.className === 'ww2') {
        if ((Math.floor(Math.random() * new Date().getTime())) & 1) {
          _results.push(attrs.aligned = 'alignleft');
        } else {
          _results.push(attrs.aligned = 'alignright');
        }
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  return Products;

})();

module.exports = Products;

},{}]},{},[1])
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL2FwcC5qcyIsIi9ob21lL2JydWNlL0dpdC9pd2lzaHVhei90bXAvY29udHJvbGxlcnMuanMiLCIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL2NvbnRyb2xsZXJzL0Fib3V0Q29udHJvbGxlci5qcyIsIi9ob21lL2JydWNlL0dpdC9pd2lzaHVhei90bXAvY29udHJvbGxlcnMvRkJDb250cm9sbGVyLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L2l3aXNodWF6L3RtcC9jb250cm9sbGVycy9MaXN0Q29udHJvbGxlci5qcyIsIi9ob21lL2JydWNlL0dpdC9pd2lzaHVhei90bXAvY29udHJvbGxlcnMvV2lzaENvbnRyb2xsZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL2RpcmVjdGl2ZXMuanMiLCIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL2ZpbHRlcnMuanMiLCIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL3NlcnZpY2VzLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L2l3aXNodWF6L3RtcC9zZXJ2aWNlcy9Mb2dnZXIuanMiLCIvaG9tZS9icnVjZS9HaXQvaXdpc2h1YXovdG1wL3NlcnZpY2VzL1Byb2R1Y3RzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG4ndXNlIHN0cmljdCc7XG52YXIgZmFjZWJvb2tfYXBwX2lkO1xuXG5mYWNlYm9va19hcHBfaWQgPSAnMTQ5NTEwOTE2NDA0MzQxMic7XG5cbnJlcXVpcmUoXCIuL3NlcnZpY2VzXCIpO1xuXG5yZXF1aXJlKFwiLi9maWx0ZXJzXCIpO1xuXG5yZXF1aXJlKFwiLi9kaXJlY3RpdmVzXCIpO1xuXG5yZXF1aXJlKFwiLi9jb250cm9sbGVyc1wiKTtcblxuYW5ndWxhci5tb2R1bGUoJ2l3aXNodWEnLCBbJ25nVG91Y2gnLCAnbmdSb3V0ZScsICduZ0ZhY2Vib29rJywgJ2JyZWV6ZS5hbmd1bGFyJywgJ2l3aXNodWEuc2VydmljZXMnLCAnaXdpc2h1YS5maWx0ZXJzJywgJ2l3aXNodWEuZGlyZWN0aXZlcycsICdpd2lzaHVhLmNvbnRyb2xsZXJzJ10pLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGZhY2Vib29rUHJvdmlkZXIpIHtcbiAgJGZhY2Vib29rUHJvdmlkZXIuc2V0QXBwSWQoXCJcIiArIGZhY2Vib29rX2FwcF9pZCk7XG4gICRmYWNlYm9va1Byb3ZpZGVyLnNldFBlcm1pc3Npb25zKFwicHVibGlzaF9zdHJlYW1cIik7XG4gICRmYWNlYm9va1Byb3ZpZGVyLnNldEN1c3RvbUluaXQoe1xuICAgIHhmYm1sOiB0cnVlLFxuICAgIHZlcnNpb246ICd2Mi4wJ1xuICB9KTtcbiAgcmV0dXJuICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy93aXNoLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdXaXNoQ29udHJvbGxlcidcbiAgfSkud2hlbignL2xpc3QvOnNraXAnLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy93aXNoLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdXaXNoQ29udHJvbGxlcidcbiAgfSkud2hlbignL2hpZGRlbicsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2hpZGRlbi5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnSGlkZGVuQ29udHJvbGxlcidcbiAgfSkud2hlbignL2hpZGRlbi86c2tpcCcsIHtcbiAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2hpZGRlbi5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnSGlkZGVuQ29udHJvbGxlcidcbiAgfSkud2hlbignL2Fib3V0Jywge1xuICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvYWJvdXQuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0Fib3V0Q29udHJvbGxlcidcbiAgfSkud2hlbignL3ByaXZhY3knLCB7XG4gICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9wcml2YWN5Lmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdBYm91dENvbnRyb2xsZXInXG4gIH0pLndoZW4oJy9zdXBwb3J0Jywge1xuICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvYWJvdXQuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0Fib3V0Q29udHJvbGxlcidcbiAgfSkub3RoZXJ3aXNlKHtcbiAgICByZWRpcmVjdFRvOiAnLydcbiAgfSk7XG59KS5ydW4oZnVuY3Rpb24oKSB7XG4gIChmdW5jdGlvbihkKSB7XG4gICAgdmFyIGlkLCBqcywgcmVmO1xuICAgIGlkID0gXCJmYWNlYm9vay1qc3Nka1wiO1xuICAgIHJlZiA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF07XG4gICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgIGpzLmlkID0gaWQ7XG4gICAganMuYXN5bmMgPSB0cnVlO1xuICAgIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9hbGwuanMjeGZibWw9MSZhcHBJZD1cIiArIGZhY2Vib29rX2FwcF9pZDtcbiAgICByZXR1cm4gcmVmLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCByZWYpO1xuICB9KShkb2N1bWVudCk7XG4gIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHJldHVybiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gIH1cbn0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ2l3aXNodWEuY29udHJvbGxlcnMnLCBbXSkuY29udHJvbGxlcignRkJDb250cm9sbGVyJywgWyckc2NvcGUnLCAnbG9nZ2VyJywgJyRmYWNlYm9vaycsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvRkJDb250cm9sbGVyJyldKS5jb250cm9sbGVyKCdBYm91dENvbnRyb2xsZXInLCBbJyRzY29wZScsICdsb2dnZXInLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL0Fib3V0Q29udHJvbGxlcicpXSkuY29udHJvbGxlcignUHJpdmFjeUNvbnRyb2xsZXInLCBbJyRzY29wZScsICdsb2dnZXInLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL1ByaXZhY3lDb250cm9sbGVyJyldKS5jb250cm9sbGVyKCdMaXN0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ2xvZ2dlcicsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvTGlzdENvbnRyb2xsZXInKV0pLmNvbnRyb2xsZXIoJ1dpc2hDb250cm9sbGVyJywgWyckc2NvcGUnLCAnbG9nZ2VyJywgJ2VudGl0eU1hbmFnZXInLCAnJHJvdXRlUGFyYW1zJywgJyRsb2NhdGlvbicsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvV2lzaENvbnRyb2xsZXInKV0pO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuJ3VzZSBzdHJpY3QnO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkc2NvcGUsIGxvZ2dlcikge307XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG4ndXNlIHN0cmljdCc7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCRzY29wZSwgbG9nZ2VyLCAkZmFjZWJvb2spIHtcbiAgcmV0dXJuICRmYWNlYm9vay5hcGkoXCIvbWVcIikudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgIHJldHVybiAkc2NvcGUudXNlcm5hbWUgPSByZXNwb25zZS5maXJzdF9uYW1lO1xuICB9KTtcbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgTGlzdENvbnRyb2xsZXI7XG5cbkxpc3RDb250cm9sbGVyID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBMaXN0Q29udHJvbGxlcigkc2NvcGUsIGxvZ2dlcikge1xuICAgIGxvZ2dlci5pbmZvKFwiTGlzdFwiKTtcbiAgfVxuXG4gIHJldHVybiBMaXN0Q29udHJvbGxlcjtcblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBMaXN0Q29udHJvbGxlcjtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbid1c2Ugc3RyaWN0Jztcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oJHNjb3BlLCBsb2dnZXIsIGVudGl0eU1hbmFnZXIsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uKSB7XG4gIHZhciBwZXJQYWdlLCBzcGlubmVyO1xuICBwZXJQYWdlID0gNTtcbiAgaWYgKCRyb3V0ZVBhcmFtcy5za2lwID09IG51bGwpIHtcbiAgICAkcm91dGVQYXJhbXMuc2tpcCA9IDA7XG4gIH1cbiAgJHNjb3BlLm5hdkxlZnQgPSBmdW5jdGlvbigkZXZlbnQpIHtcbiAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoXCIvbGlzdC9cIiArIChwYXJzZUludCgkcm91dGVQYXJhbXMuc2tpcCwgMTApICsgcGVyUGFnZSkpO1xuICB9O1xuICAkc2NvcGUubmF2UmlnaHQgPSBmdW5jdGlvbigkZXZlbnQpIHtcbiAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoXCIvbGlzdC9cIiArIChNYXRoLm1heChwYXJzZUludCgkcm91dGVQYXJhbXMuc2tpcCwgMTApIC0gcGVyUGFnZSwgMCkpKTtcbiAgfTtcbiAgc3Bpbm5lciA9IG5ldyBTcGlubmVyKHtcbiAgICByYWRpdXM6IDMwLFxuICAgIHdpZHRoOiA4LFxuICAgIGxlbmd0aDogMTZcbiAgfSk7XG4gIHNwaW5uZXIuc3Bpbihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2lzaC1zcGlubmVyJykpO1xuICByZXR1cm4gZW50aXR5TWFuYWdlci5nZXRQcm9kdWN0cygkcm91dGVQYXJhbXMuc2tpcCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIG1hc29ucnk7XG4gICAgJChcIi53aXNoLXNwbGFzaFwiKS5oaWRlKCk7XG4gICAgc3Bpbm5lci5zdG9wKCk7XG4gICAgJHNjb3BlLnNraXAgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuc2tpcCwgMTApICsgcGVyUGFnZTtcbiAgICBlbnRpdHlNYW5hZ2VyLnBhcnNlUHJvZHVjdHMoJHNjb3BlLCBkYXRhKTtcbiAgICByZXR1cm4gKG1hc29ucnkgPSAkKFwiLmpzLW1hc29ucnlcIikpLmltYWdlc0xvYWRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBtYXNvbnJ5Lm1hc29ucnkoKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ2l3aXNodWEuZGlyZWN0aXZlcycsIFtdKS5kaXJlY3RpdmUoJ2FwcFZlcnNpb24nLCBmdW5jdGlvbih2ZXJzaW9uKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMpIHtcbiAgICAgIHJldHVybiAkZWxlbWVudC50ZXh0KHZlcnNpb24pO1xuICAgIH1cbiAgfTtcbn0pLmRpcmVjdGl2ZSgnZml4Q29sbGFwc2UnLCBmdW5jdGlvbigkZG9jdW1lbnQpIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycykge1xuICAgICAgJGVsZW1lbnQuY29sbGFwc2Uoe1xuICAgICAgICB0b2dnbGU6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiAkZG9jdW1lbnQub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAkZWxlbWVudC5jb2xsYXBzZSgnaGlkZScpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG4ndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnaXdpc2h1YS5maWx0ZXJzJywgW10pLmZpbHRlcignY2FwaXRhbGlzZScsIGZ1bmN0aW9uKHN0cikge1xuICByZXR1cm4gc3RyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpO1xufSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG4ndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnaXdpc2h1YS5zZXJ2aWNlcycsIFtdKS52YWx1ZSgndmVyc2lvbicsICcwLjEuMCcpLnNlcnZpY2UoJ2xvZ2dlcicsIFsnJGxvZycsIHJlcXVpcmUoJy4vc2VydmljZXMvTG9nZ2VyJyldKS5zZXJ2aWNlKCdlbnRpdHlNYW5hZ2VyJywgWydicmVlemUnLCAnbG9nZ2VyJywgcmVxdWlyZSgnLi9zZXJ2aWNlcy9Qcm9kdWN0cycpXSk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG4ndXNlIHN0cmljdCc7XG52YXIgTG9nZ2VyO1xuXG5Mb2dnZXIgPSAoZnVuY3Rpb24oKSB7XG4gIHRvYXN0ci5vcHRpb25zLnRpbWVPdXQgPSAyMDAwO1xuXG4gIHRvYXN0ci5vcHRpb25zLnBvc2l0aW9uQ2xhc3MgPSAndG9hc3QtYm90dG9tLXJpZ2h0JztcblxuICBmdW5jdGlvbiBMb2dnZXIoJGxvZykge1xuICAgIHRoaXMuJGxvZyA9ICRsb2c7XG4gIH1cblxuICBMb2dnZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUpIHtcbiAgICB0b2FzdHIuZXJyb3IobWVzc2FnZSwgdGl0bGUpO1xuICAgIHJldHVybiB0aGlzLiRsb2cuZXJyb3IoXCJFcnJvcjogXCIgKyBtZXNzYWdlKTtcbiAgfTtcblxuICBMb2dnZXIucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbihtZXNzYWdlLCB0aXRsZSkge1xuICAgIHRvYXN0ci5pbmZvKG1lc3NhZ2UsIHRpdGxlKTtcbiAgICByZXR1cm4gdGhpcy4kbG9nLmluZm8oXCJJbmZvOiBcIiArIG1lc3NhZ2UpO1xuICB9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24obWVzc2FnZSkge1xuICAgIHJldHVybiB0aGlzLiRsb2cubG9nKG1lc3NhZ2UpO1xuICB9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUuc3VjY2VzcyA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpdGxlKSB7XG4gICAgdG9hc3RyLmluZm8obWVzc2FnZSwgdGl0bGUpO1xuICAgIHJldHVybiB0aGlzLiRsb2cuaW5mbyhcIlN1Y2Nlc3M6IFwiICsgbWVzc2FnZSk7XG4gIH07XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS53YXJuaW5nID0gZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUpIHtcbiAgICB0b2FzdHIuaW5mbyhtZXNzYWdlLCB0aXRsZSk7XG4gICAgcmV0dXJuIHRoaXMuJGxvZy53YXJuKFwiV2FybmluZzogXCIgKyBtZXNzYWdlKTtcbiAgfTtcblxuICByZXR1cm4gTG9nZ2VyO1xuXG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IExvZ2dlcjtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbid1c2Ugc3RyaWN0JztcbnZhciBQcm9kdWN0cztcblxuUHJvZHVjdHMgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIFByb2R1Y3RzKGJyZWV6ZSwgbG9nZ2VyKSB7XG4gICAgdmFyIG1ldGFkYXRhSGVscGVyLCBtZXRhZGF0YVN0b3JlLCBtb2RlbE5hbWVzcGFjZSwgc2VydmljZU5hbWU7XG4gICAgdGhpcy5icmVlemUgPSBicmVlemU7XG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgc2VydmljZU5hbWUgPSBcImh0dHBzOi8vaXdpc2h1YWRhdGEuYXp1cmUtbW9iaWxlLm5ldC9cIjtcbiAgICBtb2RlbE5hbWVzcGFjZSA9IFwiSXdpc2h1YS5Nb2RlbHNcIjtcbiAgICB0aGlzLm1vZGVsTmFtZSA9IFwiaXdpc2h1YXByb2R1Y3RzXCI7XG4gICAgbWV0YWRhdGFTdG9yZSA9IG5ldyB0aGlzLmJyZWV6ZS5NZXRhZGF0YVN0b3JlKHtcbiAgICAgIG5hbWluZ0NvbnZlbnRpb246IHRoaXMuYnJlZXplLk5hbWluZ0NvbnZlbnRpb24uY2FtZWxDYXNlXG4gICAgfSk7XG4gICAgbWV0YWRhdGFIZWxwZXIgPSBuZXcgdGhpcy5icmVlemUuY29uZmlnLk1ldGFkYXRhSGVscGVyKG1vZGVsTmFtZXNwYWNlKTtcbiAgICBtZXRhZGF0YUhlbHBlci5hZGRUeXBlVG9TdG9yZShtZXRhZGF0YVN0b3JlLCB7XG4gICAgICBuYW1lc3BhY2U6IG1vZGVsTmFtZXNwYWNlLFxuICAgICAgc2hvcnROYW1lOiB0aGlzLm1vZGVsTmFtZSxcbiAgICAgIGRlZmF1bHRSZXNvdXJjZU5hbWU6IHRoaXMubW9kZWxOYW1lLFxuICAgICAgZGF0YVByb3BlcnRpZXM6IHtcbiAgICAgICAgaWQ6IHtcbiAgICAgICAgICBtYXhMZW5ndGg6IDM2XG4gICAgICAgIH0sXG4gICAgICAgIHByb2R1Y3RJZDoge1xuICAgICAgICAgIG1heExlbmd0aDogMzZcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZHVjdFRpdGxlOiB7XG4gICAgICAgICAgbWF4TGVuZ3RoOiA0MDAwXG4gICAgICAgIH0sXG4gICAgICAgIHByb2R1Y3REZXNjcmlwdGlvbjoge1xuICAgICAgICAgIG1heExlbmd0aDogNDAwMFxuICAgICAgICB9LFxuICAgICAgICBwcm9kdWN0SW1hZ2VVcmw6IHtcbiAgICAgICAgICBtYXhMZW5ndGg6IDQwMDBcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZHVjdEJ1eVVybDoge1xuICAgICAgICAgIG1heExlbmd0aDogNDAwMFxuICAgICAgICB9LFxuICAgICAgICBwcm9kdWN0S2V5d29yZHM6IHtcbiAgICAgICAgICBtYXhMZW5ndGg6IDQwMDBcbiAgICAgICAgfSxcbiAgICAgICAgaW1wcmVzc2lvblVybDoge1xuICAgICAgICAgIG1heExlbmd0aDogNDAwMFxuICAgICAgICB9LFxuICAgICAgICBpc1B1Ymxpc2hlZDoge1xuICAgICAgICAgIGRhdGFUeXBlOiB0aGlzLmJyZWV6ZS5EYXRhVHlwZS5Cb29sZWFuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBtZXRhZGF0YUhlbHBlci5hZGREYXRhU2VydmljZShtZXRhZGF0YVN0b3JlLCBzZXJ2aWNlTmFtZSk7XG4gICAgdGhpcy5lbnRpdHlNYW5hZ2VyID0gbmV3IHRoaXMuYnJlZXplLkVudGl0eU1hbmFnZXIoe1xuICAgICAgbWV0YWRhdGFTdG9yZTogbWV0YWRhdGFTdG9yZSxcbiAgICAgIHNlcnZpY2VOYW1lOiBzZXJ2aWNlTmFtZVxuICAgIH0pO1xuICB9XG5cbiAgUHJvZHVjdHMucHJvdG90eXBlLmdldFByb2R1Y3RzID0gZnVuY3Rpb24oc2tpcCwgdGFrZSkge1xuICAgIHZhciBxdWVyeTtcbiAgICBpZiAoc2tpcCA9PSBudWxsKSB7XG4gICAgICBza2lwID0gMDtcbiAgICB9XG4gICAgaWYgKHRha2UgPT0gbnVsbCkge1xuICAgICAgdGFrZSA9IDU7XG4gICAgfVxuICAgIHF1ZXJ5ID0gdGhpcy5icmVlemUuRW50aXR5UXVlcnkuZnJvbShcInRhYmxlcy9cIiArIHRoaXMubW9kZWxOYW1lKS5za2lwKHBhcnNlSW50KHNraXAsIDEwKSkudGFrZShwYXJzZUludCh0YWtlLCAxMCkpLndoZXJlKCdpc1B1Ymxpc2hlZCcsICdlcScsIHRydWUpLmlubGluZUNvdW50KHRydWUpO1xuICAgIHJldHVybiB0aGlzLmVudGl0eU1hbmFnZXIuZXhlY3V0ZVF1ZXJ5KHF1ZXJ5KVtcImNhdGNoXCJdKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIF90aGlzLmxvZ2dlci5lcnJvcihlcnJvci5tZXNzYWdlLCBcIlF1ZXJ5IGZhaWxlZFwiKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKTtcbiAgfTtcblxuICBQcm9kdWN0cy5wcm90b3R5cGUucGFyc2VQcm9kdWN0cyA9IGZ1bmN0aW9uKCRzY29wZSwgZGF0YSkge1xuICAgIHZhciBhdHRycywgbmFtZSwgdGl0bGUsIHdvcmQsIHdvcmRzLCBfaSwgX2osIF9sZW4sIF9sZW4xLCBfcmVmLCBfcmVmMSwgX3Jlc3VsdHM7XG4gICAgJHNjb3BlLmNvdW50ID0gZGF0YS5yZXN1bHRzWzBdLmNvdW50O1xuICAgICRzY29wZS5wcm9kdWN0cyA9IGRhdGEucmVzdWx0c1swXS5yZXN1bHRzO1xuICAgIF9yZWYgPSAkc2NvcGUucHJvZHVjdHM7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgIGF0dHJzID0gX3JlZltfaV07XG4gICAgICB0aXRsZSA9IGF0dHJzLnByb2R1Y3RUaXRsZTtcbiAgICAgIGlmICh0aXRsZS5zbGljZSgwLCAxKSA9PT0gJ1wiJykge1xuICAgICAgICB0aXRsZSA9IHRpdGxlLnNsaWNlKDEsIC0xKTtcbiAgICAgIH1cbiAgICAgIHdvcmRzID0gdGl0bGUucmVwbGFjZSgvWy0sLsKpwq7ihKJdL2csICcgJykucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgXCIkMSAkMlwiKS5zcGxpdCgvXFxzKy8pO1xuICAgICAgdGl0bGUgPSB3b3Jkcy5qb2luKCcgJyk7XG4gICAgICBhdHRycy5wcm9kdWN0VGl0bGUgPSB0aXRsZTtcbiAgICAgIG5hbWUgPSAnJztcbiAgICAgIHdoaWxlICghKG5hbWUubGVuZ3RoID4gMjAgfHwgd29yZHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICBuYW1lID0gd29yZHMucG9wKCkgKyAnICcgKyBuYW1lLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHIoMSk7XG4gICAgICB9XG4gICAgICBhdHRycy5wcm9kdWN0TmFtZSA9IG5hbWU7XG4gICAgICBhdHRycy5jbGFzc05hbWUgPSAnd3cyJztcbiAgICAgIF9yZWYxID0gbmFtZS5zcGxpdCgvXFxzKy8pO1xuICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjEubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgIHdvcmQgPSBfcmVmMVtfal07XG4gICAgICAgIGlmICh3b3JkLmxlbmd0aCA+IDcpIHtcbiAgICAgICAgICBhdHRycy5jbGFzc05hbWUgPSAnaGgyJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGF0dHJzLmNsYXNzTmFtZSA9PT0gJ3d3MicpIHtcbiAgICAgICAgaWYgKChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuZXcgRGF0ZSgpLmdldFRpbWUoKSkpICYgMSkge1xuICAgICAgICAgIF9yZXN1bHRzLnB1c2goYXR0cnMuYWxpZ25lZCA9ICdhbGlnbmxlZnQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGF0dHJzLmFsaWduZWQgPSAnYWxpZ25yaWdodCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gUHJvZHVjdHM7XG5cbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvZHVjdHM7XG4iXX0=
